{# app/admin/templates/admin/product_detail.html #}
{% extends "base.html" %}

{% block content %}

{% include "admin/_toolbar.html" %}

<div class="container my-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-1">{{ product.name }}</h1>
      <div class="text-secondary small">
        ID #{{ product.id }}
        {% if product.category %}
          • Kategoria: {{ product.category.name }}
        {% endif %}
      </div>
    </div>

    <div class="d-flex flex-wrap gap-2">
      <a href="{{ url_for('shop.product_detail', product_id=product.id) }}"
         class="btn btn-sm btn-outline-light"
         target="_blank" rel="noopener">
        <i class="bi bi-eye"></i> Zobacz w sklepie
      </a>
      <a href="{{ url_for('admin.edit_product', product_id=product.id) }}"
         class="btn btn-sm btn-outline-light">
        <i class="bi bi-pencil-square"></i> Edytuj
      </a>
      <form action="{{ url_for('admin.delete_product', product_id=product.id) }}"
            method="post" class="d-inline"
            onsubmit="return confirm('Usunąć produkt {{ product.name|e }}?');">
        <button type="submit" class="btn btn-sm btn-outline-light">
          <i class="bi bi-trash"></i> Usuń
        </button>
      </form>
      <a href="{{ url_for('admin.list_products') }}" class="btn btn-sm btn-outline-light">
        <i class="bi bi-arrow-left"></i> Lista produktów
      </a>
    </div>
  </div>

  <div class="row g-4">

    <div class="col-12 col-lg-4">
      <div class="card bg-dark border-secondary h-100">
        <div class="card-body">
          <h2 class="h6 text-secondary mb-3">Zdjęcie</h2>
          {% if product.image_filename %}
            <div class="border border-secondary rounded-3 bg-black p-2 text-center">
              <img src="{{ url_for('static', filename='images/products/' ~ product.image_filename) }}"
                   alt="{{ product.name }}"
                   class="img-fluid rounded-2">
            </div>
          {% else %}
            <div class="border border-secondary rounded-3 bg-black p-4 text-center text-secondary">
              Brak zdjęcia produktu.
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-8">
      <div class="card bg-dark border-secondary mb-3">
        <div class="card-body">
          <h2 class="h6 text-secondary mb-3">Parametry</h2>

          <div class="row mb-2">
            <div class="col-6 col-md-4 text-secondary small">Cena:</div>
            <div class="col-6 col-md-8 fw-semibold">
              {{ '%.2f'|format(product.price or 0) }} PLN
            </div>
          </div>

          <div class="row mb-2">
            <div class="col-6 col-md-4 text-secondary small">Kategoria:</div>
            <div class="col-6 col-md-8">
              {% if product.category %}
                {{ product.category.name }}
              {% else %}
                <span class="text-secondary">— brak —</span>
              {% endif %}
            </div>
          </div>

          <div class="row mb-2">
            <div class="col-6 col-md-4 text-secondary small">Stan magazynowy:</div>
            <div class="col-6 col-md-8">
              {% if product.stock is not none %}
                {{ product.stock }}
              {% else %}
                0
              {% endif %}
            </div>
          </div>

        </div>
      </div>

      <div class="card bg-dark border-secondary">
        <div class="card-body">
          <h2 class="h6 text-secondary mb-3">Opis</h2>
          {% set desc =
            product.description
            or product.description_html
            or product.body
            or product.content
          %}
          {% if desc %}
            <div class="small" style="white-space: pre-wrap;">
              {{ desc }}
            </div>
          {% else %}
            <p class="text-secondary mb-0">Brak opisu produktu.</p>
          {% endif %}
        </div>
      </div>
    </div>

  </div>

  <div class="row g-4 mt-3">
    <div class="col-12">
      <div class="card bg-dark border-secondary">
        <div class="card-body">
          <h2 class="h6 text-secondary mb-3">Ostatnie komentarze do produktu</h2>

          {% if comments and comments|length %}
            <div class="list-group list-group-flush">
              {% for c in comments %}
                <div class="list-group-item bg-transparent text-light border-secondary">
                  <div class="d-flex justify-content-between">
                    <div class="small">
                      <strong>
                        {% if c.user %}
                          {{ c.user.email }}
                        {% else %}
                          Użytkownik
                        {% endif %}
                      </strong>
                      {% if c.created_at %}
                        <span class="text-secondary">
                          • {{ c.created_at.strftime('%Y-%m-%d %H:%M') }}
                        </span>
                      {% endif %}
                    </div>
                  </div>
                  <div class="small mt-1">
                    {{ c.content }}
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="text-secondary mb-0">Brak komentarzy dla tego produktu (albo nie było jeszcze zakupów / opinii).</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

</div>

{% endblock %}
