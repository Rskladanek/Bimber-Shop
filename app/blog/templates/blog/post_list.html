{% extends "base.html" %}
{% block title %}Blog{% endblock %}

{% block head %}
<style>
  .blog-page{
    color:#e5e7eb;
  }
  .blog-hero{
    border-radius:18px;
    padding:18px 20px 14px;
    background:
      radial-gradient(980px 480px at 0% 0%, rgba(129,140,248,.35), transparent 60%),
      radial-gradient(920px 520px at 100% 0%, rgba(236,72,153,.35), transparent 60%),
      rgba(15,23,42,.95);
    border:1px solid rgba(129,140,248,.4);
    box-shadow:0 24px 60px rgba(15,23,42,.9);
  }
  .blog-hero-title{
    font-size:1.6rem;
    font-weight:700;
    letter-spacing:.04em;
    text-transform:uppercase;
  }
  .blog-hero-sub{
    margin-top:4px;
    font-size:.95rem;
    color:#9ca3af;
  }
  .blog-chip{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:3px 9px;
    border-radius:999px;
    background:rgba(15,23,42,.9);
    border:1px solid rgba(148,163,184,.45);
    font-size:.8rem;
    color:#cbd5f5;
  }
  .blog-chip i{
    font-size:.9rem;
  }

  /* lista postów */
  .blog-list{
    display:flex;
    flex-direction:column;
    gap:14px;
    margin-top:14px;
  }
  .blog-card{
    display:flex;
    gap:14px;
    padding:10px;
    border-radius:16px;
    background:rgba(15,23,42,.9);
    border:1px solid rgba(148,163,184,.28);
    transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  }
  .blog-card:hover{
    transform:translateY(-2px);
    border-color:rgba(168,85,247,.8);
    box-shadow:0 18px 40px rgba(15,23,42,.85);
  }
  .blog-thumb{
    flex:0 0 130px;
    border-radius:14px;
    overflow:hidden;
    background:#020617;
  }
  .blog-thumb img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .blog-card-body{
    flex:1;
    display:flex;
    flex-direction:column;
    gap:6px;
    min-width:0;
  }
  .blog-meta{
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    align-items:center;
    font-size:.78rem;
    color:#9ca3af;
  }
  .blog-meta-pill{
    padding:2px 8px;
    border-radius:999px;
    border:1px solid rgba(129,140,248,.7);
    background:rgba(15,23,42,.9);
    font-size:.78rem;
    text-transform:uppercase;
    letter-spacing:.08em;
  }
  .blog-title{
    font-size:1.02rem;
    margin:0;
  }
  .blog-title a{
    color:#e5e7eb;
    text-decoration:none;
  }
  .blog-title a:hover{
    color:#c4b5fd;
  }
  .blog-excerpt{
    margin:0;
    font-size:.9rem;
    color:#9ca3af;
  }
  .blog-footer{
    margin-top:4px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:8px;
    font-size:.8rem;
    color:#9ca3af;
  }
  .blog-author{
    display:flex;
    align-items:center;
    gap:6px;
  }
  .blog-author-avatar{
    width:22px;
    height:22px;
    border-radius:999px;
    background:radial-gradient(circle at 30% 0%,#f97316,#ea580c);
  }

  /* sidebar */
  .blog-sidebar{
    position:sticky;
    top:82px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .blog-side-card{
    padding:12px;
    border-radius:16px;
    background:rgba(15,23,42,.9);
    border:1px solid rgba(148,163,184,.3);
  }
  .blog-side-title{
    font-size:.85rem;
    text-transform:uppercase;
    letter-spacing:.1em;
    color:#9ca3af;
    margin-bottom:6px;
  }
  .blog-cat-list,
  .blog-recent-list{
    list-style:none;
    margin:0;
    padding:0;
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .blog-cat-link{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:6px 8px;
    border-radius:999px;
    text-decoration:none;
    border:1px solid rgba(55,65,81,.8);
    background:rgba(15,23,42,.9);
    font-size:.85rem;
    color:#e5e7eb;
  }
  .blog-cat-link span:last-child{
    font-size:.78rem;
    color:#9ca3af;
  }
  .blog-cat-link.active{
    border-color:rgba(168,85,247,.9);
    box-shadow:0 0 0 1px rgba(168,85,247,.5) inset;
  }
  .blog-recent-item a{
    color:#e5e7eb;
    text-decoration:none;
    font-size:.9rem;
  }
  .blog-recent-item a:hover{
    color:#c4b5fd;
  }
  .blog-recent-meta{
    font-size:.75rem;
    color:#9ca3af;
  }

  .text-muted-soft{color:#9ca3af;font-size:.85rem;}

  @media (max-width:767.98px){
    .blog-card{
      flex-direction:column;
    }
    .blog-thumb{width:100%;height:170px;}
  }
</style>
{% endblock %}

{% block content %}
<div class="container my-3 blog-page">
  <div class="row g-3">
    <!-- LEWA KOLUMNA: HERO + LISTA POSTÓW -->
    <div class="col-lg-8">
      <section class="blog-hero">
        <div class="d-flex justify-content-between flex-wrap gap-2 align-items-center">
          <div>
            <div class="blog-hero-title">Blog</div>
            <div class="blog-hero-sub">
              Aktualności, poradniki i historie związane z Bimberek Białostocki.
            </div>
          </div>
          <div class="d-flex flex-column align-items-end gap-1">
            <span class="blog-chip">
              <i class="bi bi-journal-text"></i>
              {{ posts.total if posts is defined else (posts.items|length if posts and posts.items is defined else 0) }} wpisów
            </span>
            {% if q %}
              <span class="text-muted-soft">Filtr: „{{ q }}”</span>
            {% endif %}
          </div>
        </div>
      </section>

      {% if posts and posts.items|length %}
        <div class="blog-list">
          {% for post in posts.items %}
          <article class="blog-card">
            <a class="blog-thumb" href="{{ url_for('blog.post_detail', post_id=post.id) }}">
              {% if post.cover_image %}
                <img src="{{ url_for('static', filename='images/blog/' ~ post.cover_image) }}" alt="{{ post.title }}">
              {% else %}
                <img src="{{ url_for('static', filename='images/placeholder_wide.jpg') }}" alt="">
              {% endif %}
            </a>
            <div class="blog-card-body">
              <div class="blog-meta">
                {% if post.category %}
                  <span class="blog-meta-pill">{{ post.category.name }}</span>
                {% endif %}
                <span>
                  {% if post.published_at %}
                    {{ post.published_at.strftime('%d.%m.%Y') }}
                  {% elif post.created_at %}
                    {{ post.created_at.strftime('%d.%m.%Y') }}
                  {% endif %}
                </span>
                {% if post.read_time %}
                  <span>· {{ post.read_time }} min czytania</span>
                {% endif %}
              </div>
              <h2 class="blog-title">
                <a href="{{ url_for('blog.post_detail', post_id=post.id) }}">{{ post.title }}</a>
              </h2>
              {% if post.subtitle %}
                <p class="blog-excerpt">{{ post.subtitle }}</p>
              {% elif post.body_html %}
                <p class="blog-excerpt">
                  {{ post.body_html|striptags|truncate(180) }}
                </p>
              {% endif %}
              <div class="blog-footer">
                <div class="blog-author">
                  <div class="blog-author-avatar"></div>
                  <span>
                    {% if post.author and (post.author.name or post.author.email) %}
                      {{ post.author.name or post.author.email }}
                    {% else %}
                      Redakcja
                    {% endif %}
                  </span>
                </div>
                <a class="btn btn-sm btn-outline-light" href="{{ url_for('blog.post_detail', post_id=post.id) }}">
                  Czytaj
                </a>
              </div>
            </div>
          </article>
          {% endfor %}
        </div>

        {% if posts.pages > 1 %}
        <nav class="mt-3">
          <ul class="pagination pagination-sm mb-0">
            <li class="page-item {% if not posts.has_prev %}disabled{% endif %}">
              <a class="page-link" href="{{ url_for('blog.post_list', page=posts.prev_num, cat=current_category_id, q=q) }}">«</a>
            </li>
            {% for p in range(1, posts.pages+1) %}
              <li class="page-item {% if p==posts.page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('blog.post_list', page=p, cat=current_category_id, q=q) }}">{{ p }}</a>
              </li>
            {% endfor %}
            <li class="page-item {% if not posts.has_next %}disabled{% endif %}">
              <a class="page-link" href="{{ url_for('blog.post_list', page=posts.next_num, cat=current_category_id, q=q) }}">»</a>
            </li>
          </ul>
        </nav>
        {% endif %}
      {% else %}
        <div class="alert alert-secondary mt-3 mb-0">
          Na razie brak wpisów. Dodaj coś w panelu admina.
        </div>
      {% endif %}
    </div>

    <!-- PRAWA KOLUMNA: SIDEBAR -->
    <div class="col-lg-4">
      <aside class="blog-sidebar">
        <!-- Szukajka -->
        <div class="blog-side-card">
          <div class="blog-side-title">Szukaj</div>
          <form method="get" action="{{ url_for('blog.post_list') }}">
            {% if current_category_id %}
              <input type="hidden" name="cat" value="{{ current_category_id }}">
            {% endif %}
            <div class="input-group input-group-sm">
              <input type="search"
                     name="q"
                     value="{{ q or '' }}"
                     class="form-control"
                     placeholder="Wpisz tytuł, tag, treść...">
              <button class="btn btn-primary">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </form>
        </div>

        <!-- Kategorie -->
        <div class="blog-side-card">
          <div class="blog-side-title">Kategorie</div>
          <ul class="blog-cat-list">
            <li>
              <a class="blog-cat-link {% if not current_category_id %}active{% endif %}"
                 href="{{ url_for('blog.post_list', q=q) }}">
                <span>Wszystko</span>
                {% if posts is defined %}
                  <span>{{ posts.total }}</span>
                {% endif %}
              </a>
            </li>
            {% if categories %}
              {% for c in categories %}
              <li>
                <a class="blog-cat-link {% if current_category_id==c.id %}active{% endif %}"
                   href="{{ url_for('blog.post_list', cat=c.id, q=q) }}">
                  <span>{{ c.name }}</span>
                  {% if c.posts_count is defined %}
                    <span>{{ c.posts_count }}</span>
                  {% endif %}
                </a>
              </li>
              {% endfor %}
            {% else %}
              <li class="text-muted-soft">Dodaj kategorie w panelu admina.</li>
            {% endif %}
          </ul>
        </div>

        <!-- Ostatnie wpisy -->
        {% if recent_posts %}
        <div class="blog-side-card">
          <div class="blog-side-title">Ostatnie wpisy</div>
          <ul class="blog-recent-list">
            {% for p in recent_posts %}
            <li class="blog-recent-item">
              <a href="{{ url_for('blog.post_detail', post_id=p.id) }}">{{ p.title }}</a>
              <div class="blog-recent-meta">
                {% if p.published_at %}
                  {{ p.published_at.strftime('%d.%m.%Y') }}
                {% elif p.created_at %}
                  {{ p.created_at.strftime('%d.%m.%Y') }}
                {% endif %}
              </div>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </aside>
    </div>
  </div>
</div>
{% endblock %}
