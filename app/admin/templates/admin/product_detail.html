{% extends "base.html" %}
{% block title %}{{ product.name }} – Panel admina{% endblock %}

{% block content %}
{% include "admin/_toolbar.html" %}

<div class="container py-4">

  <!-- Nagłówek strony -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-1">{{ product.name }}</h1>
      <p class="text-muted small mb-0">
        Szczegóły produktu w panelu sklepu Bimberek.
      </p>
    </div>
    <div class="d-flex gap-2">
      <a href="{{ url_for('shop.product_detail', product_id=product.id) }}"
         class="btn btn-outline-light btn-sm"
         target="_blank" rel="noopener">
        Podgląd w sklepie
      </a>
      <a href="{{ url_for('admin.list_products') }}"
         class="btn btn-outline-secondary btn-sm">
        Lista produktów
      </a>
    </div>
  </div>

  <!-- Główna sekcja: obraz + meta -->
  <div class="row g-4">

    <!-- LEWA: zdjęcie produktu -->
    <div class="col-lg-5">
      <div class="card bg-dark border-secondary h-100">
        {% if product.image_filename %}
        <img
          src="{{ url_for('static', filename='images/products/' ~ product.image_filename) }}"
          class="card-img-top"
          alt="{{ product.name }}">
        {% else %}
        <div class="card-body d-flex align-items-center justify-content-center text-muted">
          Brak zdjęcia produktu
        </div>
        {% endif %}
      </div>
    </div>

    <!-- PRAWA: parametry / stan magazynowy / meta -->
    <div class="col-lg-7">
      <div class="card bg-dark border-secondary mb-3">
        <div class="card-body">
          <div class="d-flex flex-wrap justify-content-between align-items-baseline mb-2">
            <div>
              <div class="text-muted small mb-1">Cena brutto</div>
              <div class="h4 mb-0">{{ '%.2f'|format(product.price) }} PLN</div>
            </div>
            <div class="text-end">
              <div class="text-muted small mb-1">Stan magazynowy</div>
              <div class="h5 mb-0">
                {% if product.stock is not none %}
                  {{ product.stock }} <span class="text-muted small">szt.</span>
                {% else %}
                  <span class="text-muted">brak danych</span>
                {% endif %}
              </div>
            </div>
          </div>

          <hr class="border-secondary my-3">

          <dl class="row mb-0 small">
            <dt class="col-sm-4 text-muted">Kategoria</dt>
            <dd class="col-sm-8">
              {% if product.category %}
                {{ product.category.name }}
              {% else %}
                <span class="text-muted">— brak kategorii —</span>
              {% endif %}
            </dd>

            <dt class="col-sm-4 text-muted">ID produktu</dt>
            <dd class="col-sm-8">#{{ product.id }}</dd>

            {% if product.volume_ml %}
            <dt class="col-sm-4 text-muted">Pojemność</dt>
            <dd class="col-sm-8">{{ product.volume_ml }} ml</dd>
            {% endif %}

            {% if product.abv %}
            <dt class="col-sm-4 text-muted">Moc</dt>
            <dd class="col-sm-8">~{{ product.abv }}%</dd>
            {% endif %}

            {% if product.type %}
            <dt class="col-sm-4 text-muted">Typ</dt>
            <dd class="col-sm-8">{{ product.type }}</dd>
            {% endif %}

            {% if product.region %}
            <dt class="col-sm-4 text-muted">Region</dt>
            <dd class="col-sm-8">{{ product.region }}</dd>
            {% endif %}

            {% if product.is_new is not none %}
            <dt class="col-sm-4 text-muted">Nowość</dt>
            <dd class="col-sm-8">
              {% if product.is_new %}
                <span class="badge bg-success-soft text-success">Nowy produkt</span>
              {% else %}
                <span class="text-muted">Nie</span>
              {% endif %}
            </dd>
            {% endif %}

            {% if product.is_bestseller is not none %}
            <dt class="col-sm-4 text-muted">Bestseller</dt>
            <dd class="col-sm-8">
              {% if product.is_bestseller %}
                <span class="badge bg-warning-soft text-warning">Bestseller</span>
              {% else %}
                <span class="text-muted">Nie</span>
              {% endif %}
            </dd>
            {% endif %}

            {% if product.created_at %}
            <dt class="col-sm-4 text-muted">Utworzono</dt>
            <dd class="col-sm-8">
              {{ product.created_at.strftime('%Y-%m-%d %H:%M') }}
            </dd>
            {% endif %}

            {% if product.updated_at %}
            <dt class="col-sm-4 text-muted">Ostatnia edycja</dt>
            <dd class="col-sm-8">
              {{ product.updated_at.strftime('%Y-%m-%d %H:%M') }}
            </dd>
            {% endif %}
          </dl>
        </div>
      </div>

      <!-- Komentarze / zgłoszenia – podsumowanie -->
      <div class="card bg-dark border-secondary">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <h2 class="h6 mb-0">Aktywność użytkowników</h2>
          </div>
          <p class="text-muted small mb-2">
            Poniżej szybki podgląd komentarzy związanych z tym produktem.
            Pełna moderacja jest dostępna w zakładce „Komentarze” panelu admina.
          </p>

          {% if comments is defined and comments %}
          <ul class="list-unstyled mb-0 small">
            {% for c in comments[:5] %}
            <li class="mb-1">
              <span class="text-muted">
                {{ c.user.email if c.user and c.user.email else 'Użytkownik' }}
                {% if c.created_at %} • {{ c.created_at.strftime('%Y-%m-%d %H:%M') }}{% endif %}
              </span><br>
              {{ c.content }}
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="text-muted small mb-0">Brak komentarzy powiązanych z tym produktem.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- OPIS produktu -->
  <div class="row g-4 mt-3">
    <div class="col-12">
      <div class="card bg-dark border-secondary">
        <div class="card-body">
          <h2 class="h6 mb-2">Opis produktu</h2>
          <div class="small">
            {% if product.description_html %}
              {{ product.description_html|safe }}
            {% elif product.description %}
              {{ product.description }}
            {% else %}
              <span class="text-muted">
                Brak opisu. Uzupełnij treść w edycji produktu.
              </span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}
