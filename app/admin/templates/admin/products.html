{% extends "base.html" %}
{% block title %}Produkty - Panel admina{% endblock %}

{% block content %}
{% include "admin/_toolbar.html" %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-1">Produkty</h1>
      <p class="text-muted small mb-0">Zarządzanie asortymentem sklepu.</p>
    </div>
    <a href="{{ url_for('admin.add_product') }}" class="btn btn-primary btn-sm">
      <i class="bi bi-plus-circle me-1"></i> Dodaj produkt
    </a>
  </div>

  {% if products %}
    <div class="table-responsive">
      <table class="table table-dark table-striped table-hover align-middle table-admin">
        <thead>
          <tr>
            <th>ID</th>
            <th>Produkt</th>
            <th>Cena</th>
            <th>Kategoria</th>
            <th>Akcje</th>
          </tr>
        </thead>
        <tbody>
          {% for p in products %}
          <tr>
            <td class="small text-muted">#{{ p.id }}</td>
            <td>
              <div class="d-flex align-items-center gap-2">
                {% if p.image_filename %}
                  <img src="{{ url_for('static', filename='images/products/' ~ p.image_filename) }}"
                       class="admin-product-thumb" alt="{{ p.name }}">
                {% endif %}
                <div>
                  <div class="fw-semibold small">{{ p.name }}</div>
                  {% if p.description_html %}
                    <div class="text-muted small text-truncate" style="max-width: 260px;">
                      {{ p.description_html|striptags }}
                    </div>
                  {% endif %}
                </div>
              </div>
            </td>
            <td>{{ "%.2f"|format(p.price) }} PLN</td>
            <td class="small">
              {{ p.category.name if p.category else "-" }}
            </td>
            <td>
              <div class="d-flex flex-wrap gap-1">
                <a href="{{ url_for('admin.view_product', product_id=p.id) }}"
                   class="btn btn-sm btn-outline-light">
                  Podgląd
                </a>
                <a href="{{ url_for('admin.edit_product', product_id=p.id) }}"
                   class="btn btn-sm btn-outline-light">
                  Edytuj
                </a>
                <a href="{{ url_for('shop.product_detail', product_id=p.id) }}"
                   class="btn btn-sm btn-outline-primary" target="_blank">
                  W sklepie
                </a>
                <a href="{{ url_for('admin.delete_product', product_id=p.id) }}"
                   class="btn btn-sm btn-outline-danger"
                   onclick="return confirm('Na pewno usunąć ten produkt?');">
                  Usuń
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">Brak produktów.</p>
  {% endif %}
</div>
{% endblock %}
