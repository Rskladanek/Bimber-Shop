{% extends "base.html" %}
{% block title %}Sklep - wszystkie produkty{% endblock %}

{% block content %}
<div class="shop-layout">
  <!-- Boczny panel kategorii -->
  <aside class="shop-sidebar">
    <div class="shop-sidebar-title">Kategorie</div>
    {% if categories %}
      <ul class="shop-category-list">
        {% for cat in categories %}
          {% set icon = category_icons.get(cat.name, 'bi-circle') %}
          <li class="shop-category-item">
            <a href="{{ url_for('shop.category_view', category_id=cat.id) }}"
               class="shop-category-link">
              <i class="bi {{ icon }}"></i>
              <span>{{ cat.name }}</span>
            </a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted small px-3 mb-0">
        Brak kategorii – dodaj je w bazie / panelu.
      </p>
    {% endif %}
  </aside>

  <!-- Grid produktów -->
  <section>
    <div class="shop-products-header mb-3">
      <h1 class="h4 mb-0">Sklep</h1>
      <div class="text-muted small">
        {{ products|length }} produktów
      </div>
    </div>

    {% if products %}
      <div class="shop-products-grid">
        {% for p in products %}
          <div class="card product-card shop-product-card">
            {% if p.image_filename %}
              <img
                src="{{ url_for('static', filename='images/products/' ~ p.image_filename) }}"
                class="card-img-top ratio-4x3"
                alt="{{ p.name }}"
              >
            {% endif %}
            <div class="card-body d-flex flex-column">
              <h2 class="fs-6 mb-1 text-truncate-2">{{ p.name }}</h2>
              <p class="card-text small text-muted flex-grow-1 text-truncate-3">
                {{ p.description_html|striptags|truncate(140) }}
              </p>
              <div class="d-flex justify-content-between align-items-center mt-2">
                <span class="price">{{ "%.2f"|format(p.price) }} PLN</span>
                <a href="{{ url_for('shop.product_detail', product_id=p.id) }}"
                   class="btn btn-sm btn-outline-primary">
                  Szczegóły
                </a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">Brak produktów.</p>
    {% endif %}
  </section>
</div>
{% endblock %}
